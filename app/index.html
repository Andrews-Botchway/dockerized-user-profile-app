<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Profile</title>
<style>
    .container {
        margin: 40px auto;
        width: 80%;
        max-width: 500px;
    }

    .button {
        width: 160px;
        height: 45px;
        border-radius: 6px;
        font-size: 15px;
        margin-top: 20px;
        cursor: pointer;
    }

    img {
        width: 328px;
        height: 287px;
        display: block;
        margin-bottom: 20px;
        object-fit: cover;
        border-radius: 6px;
    }

    hr {
        width: 100%;
        margin: 15px 0;
        border: 1px solid #ccc;
    }

    h3 {
        display: inline-block;
        margin-left: 5px;
    }

    #container, #container-edit {
        display: none;
    }

    #container-edit input {
        width: 100%;
        font-size: 15px;
        height: 32px;
        padding: 4px 8px;
        margin-top: 4px;
    }

    .button-group {
        display: flex;
        gap: 10px;
    }

    .error-message {
        color: red;
        margin-top: 10px;
    }

    .success-message {
        color: green;
        margin-top: 10px;
    }
</style>
</head>
<body>

<div class="container" id="container">
    <h1>User Profile</h1>
    <img src="https://via.placeholder.com/328x287" alt="user-profile">
    <div><span>Name:</span><h3 id="name">Anna Smith</h3></div>
    <hr>
    <div><span>Email:</span><h3 id="email">anna.smith@example.com</h3></div>
    <hr>
    <div><span>Interests:</span><h3 id="interests">coding</h3></div>
    <hr>
    <button class="button" onclick="showEditForm()">Edit Profile</button>
    <div id="fetch-error" class="error-message"></div>
</div>

<div class="container" id="container-edit">
    <h1>Edit Profile</h1>
    <img src="https://via.placeholder.com/328x287" alt="user-profile">
    
    <div>
        <label for="input-name">Name:</label>
        <input type="text" id="input-name" placeholder="Enter name">
    </div>
    <hr>
    <div>
        <label for="input-email">Email:</label>
        <input type="email" id="input-email" placeholder="Enter email">
    </div>
    <hr>
    <div>
        <label for="input-interests">Interests:</label>
        <input type="text" id="input-interests" placeholder="Enter interests">
    </div>
    <hr>
    
    <div class="button-group">
        <button class="button" onclick="updateProfileRequest()">Save</button>
        <button class="button" onclick="cancelEdit()">Cancel</button>
    </div>

    <div id="update-message"></div>
</div>

<script>
async function init() {
    try {
        const response = await fetch('http://localhost:3000/get-profile');
        if (!response.ok) throw new Error('Network response was not ok');
        const user = await response.json();

        document.getElementById('name').textContent = user.name || 'Anna Smith';
        document.getElementById('email').textContent = user.email || 'anna.smith@example.com';
        document.getElementById('interests').textContent = user.interests || 'coding';

        document.getElementById('container').style.display = 'block';
    } catch (error) {
        document.getElementById('fetch-error').textContent = "Failed to load profile. Please try again.";
        console.error(error);
    }
}

function showEditForm() {
    const container = document.getElementById('container');
    const editContainer = document.getElementById('container-edit');

    document.getElementById('input-name').value = document.getElementById('name').textContent;
    document.getElementById('input-email').value = document.getElementById('email').textContent;
    document.getElementById('input-interests').value = document.getElementById('interests').textContent;

    container.style.display = 'none';
    editContainer.style.display = 'block';
    document.getElementById('update-message').textContent = '';
}

function cancelEdit() {
    document.getElementById('container').style.display = 'block';
    document.getElementById('container-edit').style.display = 'none';
}

async function updateProfileRequest() {
    const payload = {
        name: document.getElementById('input-name').value,
        email: document.getElementById('input-email').value,
        interests: document.getElementById('input-interests').value
    };

    try {
        const response = await fetch('http://localhost:3000/update-profile', {
            method: "POST",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error('Network response was not ok');

        const updatedUser = await response.json();

        document.getElementById('name').textContent = updatedUser.name;
        document.getElementById('email').textContent = updatedUser.email;
        document.getElementById('interests').textContent = updatedUser.interests;

        document.getElementById('update-message').textContent = 'Profile updated successfully!';
        document.getElementById('update-message').className = 'success-message';

        cancelEdit();
    } catch (error) {
        document.getElementById('update-message').textContent = 'Failed to update profile.';
        document.getElementById('update-message').className = 'error-message';
        console.error(error);
    }
}

window.onload = init;
</script>
</body>
</html>
